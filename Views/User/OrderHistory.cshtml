@model IEnumerable<WEBVANDAP.Models.Order>

@{
    ViewBag.Title = "Lịch sử đặt hàng - LogiT Shop";
    Layout = "~/Views/Shared/_Layout.cshtml"; // 1. Sử dụng Layout chung
}

@section Styles {
    <style>
        /* CSS riêng cho trang Lịch sử đơn hàng */
        body {
            background-color: #f5f5f5;
        }

        /* Card */
        .order-card {
            border: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            background-color: #fff; /* Đảm bảo nền trắng cho card */
        }

            .order-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            }

        .order-header {
            background-color: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #eee;
            border-radius: 12px 12px 0 0; /* Bo tròn góc trên */
        }

        .order-body {
            padding: 1.25rem 1.5rem;
        }

        .price {
            color: #d0021c;
            font-weight: 600;
        }

        .badge {
            font-size: 0.9rem;
            padding: 6px 12px;
            border-radius: 30px;
        }

        .alert {
            border-radius: 15px;
        }
    </style>
}

<div class="container my-5">
    <h2 class="fw-bold mb-4 text-uppercase text-dark">
        <i class="bi bi-clock-history text-primary me-2"></i> Lịch sử đơn hàng của bạn
    </h2>

    @if (Model != null && Model.Any())
    {
        <div class="row g-4">
            @foreach (var order in Model)
            {
                var date = order.OrderDate != null ? string.Format("{0:dd/MM/yyyy HH:mm}", order.OrderDate) : "—";
                string statusClass = "bg-primary text-white";
                string statusText = "Mới";

                if (order.Status == "Shipped") { statusClass = "bg-warning text-dark"; statusText = "Đang xử lý"; }
                else if (order.Status == "Delivered") { statusClass = "bg-success text-white"; statusText = "Đã giao"; }
                else if (order.Status == "Cancelled") { statusClass = "bg-danger text-white"; statusText = "Đã hủy"; }

                <div class="col-md-6 col-lg-4">
                    <div class="card order-card shadow h-100">
                        <div class="order-header d-flex justify-content-between align-items-center">
                            <span class="fw-bold text-primary">Mã: @order.OrderCode</span>
                            <span class="badge @statusClass">@statusText</span>
                        </div>
                        <div class="order-body">
                            <p class="mb-1 text-muted"><i class="bi bi-calendar3"></i> Ngày đặt: @date</p>
                            <p class="mb-2 fw-bold price">@string.Format("{0:N0}", order.TotalAmount) đ</p>
                            <div class="d-flex justify-content-between mt-3">
                                <a href="@Url.Action("OrderConfirmation", "Order", new { orderId = order.Id })" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-eye"></i> Xem chi tiết
                                </a>
                                <a href="@Url.Action("Index","Home")" class="btn btn-danger btn-sm">
                                    <i class="bi bi-cart-plus"></i> Mua thêm
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-light border text-center py-5 shadow-sm">
            <i class="bi bi-emoji-frown fs-2 text-secondary d-block mb-3"></i>
            <p class="mb-2">Bạn chưa có đơn hàng nào.</p>
            <a href="@Url.Action("Index", "Home")" class="btn btn-danger px-4">
                <i class="bi bi-cart-plus"></i> Mua sắm ngay
            </a>
        </div>
    }

    <div class="mt-5 text-end">
        <a href="@Url.Action("Index", "User")" class="btn btn-outline-dark rounded-pill px-4">
            <i class="bi bi-arrow-left"></i> Quay lại Hồ sơ
        </a>
    </div>
</div>
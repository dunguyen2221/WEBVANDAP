@model IEnumerable<WEBVANDAP.Models.AspNetUser>

@{
    ViewBag.Title = "Quản Lý Người Dùng";
    Layout = "~/Views/Shared/Layout2.cshtml";
}

<style>
    .badge {
        font-size: 0.85rem;
        padding: 0.4em 0.7em;
    }

    .table-hover tbody tr:hover {
        background-color: #f1f3f5;
    }

    .main-content {
        background-color: #f8f9fa;
        min-height: 100vh;
        padding: 2rem;
    }
</style>

<!-- MAIN CONTENT -->
<div class="flex-grow-1 p-4 main-content">

    <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-3 rounded-3 shadow-sm">
        <h2 class="text-dark fw-bold h4 mb-0">Quản lý người dùng</h2>
        <i style="transform: scale(3);" class="bi bi-people-fill me-4"></i>
    </div>

    <div class="card shadow-sm border-0 rounded-3 bg-white">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold mb-0">Danh sách Người Dùng</h5>

                <div class="d-flex align-items-center gap-2" style="width: 250px;">
                    <label class="form-label small mb-0">Search:</label>
                    <input type="search" class="form-control form-control-sm" id="tableSearch" />
                </div>
            </div>

            <div class="table-responsive">

                @if (Model != null && Model.Any())
                {
                    <table class="table table-hover table-bordered align-middle small caption-top">
                        <thead class="table-light">
                            <tr>
                                <th class="text-center">ID</th>
                                <th>Tên Đăng Nhập</th>
                                <th>Email</th>
                                <th>Số ĐT</th>
                                <th class="text-center">Xác thực Email</th>
                                <th class="text-center">Trạng Thái</th>
                                <th class="text-center">Thao tác</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var item in Model)
                            {
                                string statusText = item.IsLocked ? "Đã Khóa" : "Hoạt động";
                                string statusClass = item.IsLocked ? "bg-danger" : "bg-success";

                                <tr>
                                    <td>@item.Id.Substring(0, 8)...</td>
                                    <td>@item.UserName</td>
                                    <td>@item.Email</td>
                                    <td>@(string.IsNullOrEmpty(item.PhoneNumber) ? "N/A" : item.PhoneNumber)</td>

                                    <td class="text-center">
                                        <span class="badge @(item.EmailConfirmed ? "bg-success" : "bg-warning")">
                                            @(item.EmailConfirmed ? "Đã X.Thực" : "Chưa X.Thực")
                                        </span>
                                    </td>

                                    <td class="text-center">
                                        <span class="badge @statusClass">@statusText</span>
                                    </td>

                                    <td class="text-center">
                                        @Html.ActionLink("Sửa", "AdminEdit", new { id = item.Id }, new { @class = "btn btn-sm btn-info me-1" })

                                        @if (item.IsLocked)
                                        {
                                            @Html.ActionLink("Mở Khóa", "UnlockUser", new { id = item.Id },
                                               new { @class = "btn btn-sm btn-success", onclick = "return confirm('Bạn chắc muốn mở khóa?');" })
                                        }
                                        else
                                        {
                                            @Html.ActionLink("Khóa", "LockUser", new { id = item.Id },
                                               new { @class = "btn btn-sm btn-warning", onclick = "return confirm('Bạn chắc muốn khóa tài khoản?');" })
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>

                    </table>
                }
                else
                {
                    <p class="text-center text-muted p-4">Không tìm thấy tài khoản người dùng nào.</p>
                }
            </div>

        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Search table
    document.getElementById('tableSearch').addEventListener('input', function () {
        var filter = this.value.toLowerCase();
        var rows = document.querySelectorAll('table tbody tr');
        rows.forEach(function (row) {
            var text = row.innerText.toLowerCase();
            row.style.display = text.includes(filter) ? '' : 'none';
        });
    });
</script>

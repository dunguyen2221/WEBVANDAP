@model IEnumerable<WEBVANDAP.Models.Review>

@{
    ViewBag.Title = "Quản Lý Đánh Giá";
    Layout = "~/Views/Shared/Layout2.cshtml"; // Sử dụng Layout Admin nhúng trực tiếp (Sidebar cố định)
}


<div class="flex-grow-1 p-4 d-flex flex-column main-content">

    <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-3 rounded-3 shadow-sm">
        <h2 class="text-dark fw-bold h4 mb-0">Quản lý Đánh giá Sản phẩm</h2>
        <i style="scale: 2.5;" class="bi bi-chat-left-quote me-4 text-primary"></i>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="card shadow-sm border-0 rounded-3 bg-white">
        <div class="card-body p-4">

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold mb-0">Danh sách Đánh giá (@(Model != null ? Model.Count() : 0))</h5>
            </div>

            <div class="table-responsive">
                @if (Model != null && Model.Any())
                {
                    <table class="table table-hover table-bordered align-middle small caption-top">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 5%;">ID</th>
                                <th style="width: 20%;">Sản phẩm</th>
                                <th style="width: 15%;">Người dùng</th>
                                <th style="width: 15%;" class="text-center">Đánh giá</th>
                                <th style="width: 25%;">Nội dung</th>
                                <th style="width: 10%;">Ngày tạo</th>
                                <th style="width: 10%;" class="text-center">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>@item.Id</td>
                                    <td>
                                        <a href="@Url.Action("Details", "Product", new { id = item.ProductId })" target="_blank" class="text-decoration-none fw-bold">
                                            @(item.Product != null ? item.Product.Name : "SP đã xóa")
                                        </a>
                                    </td>
                                    <td>@(item.AspNetUser != null ? item.AspNetUser.UserName : "Ẩn danh")</td>

                                    <td class="text-center star-rating">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            if (i <= item.Rating)
                                            {
                                                <i class="bi bi-star-fill"></i>
                                            }
                                            else
                                            {
                                                <i class="bi bi-star"></i>
                                            }
                                        }
                                    </td>

                                    <td>
                                        <div class="review-content" title="@item.Comment">
                                            @item.Comment
                                        </div>
                                    </td>

                                    <td>@(item.CreatedAt.HasValue ? item.CreatedAt.Value.ToString("dd/MM/yyyy") : "")</td>

                                    <td class="text-center">
                                        @using (Html.BeginForm("Delete", "Review", FormMethod.Post))
                                        {
                                            @Html.Hidden("id", item.Id)
                                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Bạn có chắc chắn muốn xóa đánh giá này không?');">
                                                <i class="bi bi-trash"></i> Xóa
                                            </button>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <div class="text-center py-5 text-muted">
                        <i class="bi bi-chat-square-text fs-1"></i>
                        <p class="mt-2">Chưa có đánh giá nào.</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>



